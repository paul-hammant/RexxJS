<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>RexxJS Error Handling Demo</title>


    <!-- Shared demo CSS -->
    <link rel="stylesheet" href="demo-common.css">

    <!-- Load the RexxJS bundle -->
    <script src="dist/rexxjs.bundle.js"></script>

    <!-- Load the document write styled output handler -->
    <script src="../output/document-write-styled-output-handler.js"></script>

    <!-- Load the shared demo executor -->
    <script src="demo-executor.js"></script>

    <!-- REXX Script for error handling demonstration -->
    <script type="text/rexx" id="error-handling-script">
        /* Auto-executing REXX Error Handling Demo */

        SAY "=== REXX Error Handling Demo ==="
        SAY ""

        /* RC variable for checking results */
        SAY "RC (Return Code) Variable:"
        SAY "  RC is automatically set after operations"
        SAY "  RC = 0 typically means success"
        SAY "  RC <> 0 typically indicates an error"
        SAY ""

        /* Checking for errors in arithmetic */
        SAY "Arithmetic Error Checking:"
        LET x = 10
        LET y = 2
        LET result = x / y
        SAY "  10 / 2 = " || result || " (RC = " || RC || ")"
        SAY ""

        /* Invalid operation handling */
        SAY "Handling Invalid Values:"
        LET testVal = "not_a_number"
        LET attemptCalc = testVal + 5
        SAY "  'not_a_number' + 5 = " || attemptCalc || " (RC = " || RC || ")"
        SAY ""

        /* SIGNAL for error handling */
        SAY "Conditional Error Handling:"
        LET a = 100
        LET b = 0
        IF b = 0 THEN DO
            SAY "  Division by zero detected!"
            SAY "  Cannot divide 100 by 0"
        END
        ELSE DO
            SAY "  100 / " || b || " = " || (a / b)
        END
        SAY ""

        /* Try operations and check results */
        SAY "Sequential Operation with Error Checks:"
        LET value = 25
        SAY "  Starting value: " || value

        IF value > 0 THEN DO
            SAY "  Value is positive - proceeding"
            LET doubled = value * 2
            SAY "  Doubled: " || doubled
        END
        ELSE DO
            SAY "  ERROR: Value must be positive"
        END
        SAY ""

        /* EXIST function to check if variables are set */
        SAY "Variable Existence Check:"
        IF SYMBOL('existingVar') = 'LIT' THEN SAY "  Variable 'existingVar' is not defined"
        ELSE SAY "  Variable 'existingVar' is defined"
        SAY ""

        /* Safe string operations */
        SAY "Safe String Operations:"
        LET str = "Hello"
        LET index = INDEX(str, "llo")
        IF index > 0 THEN SAY "  Found 'llo' at position " || index
        ELSE SAY "  'llo' not found in string"
        SAY ""
        SAY "=== Error Handling Demo Complete ==="

        /* Nested error handling */
        SAY "Nested Error Handling:"
        LET counter = 0
        DO i = 1 TO 3
            counter = counter + 1
            IF i = 2 THEN DO
                SAY "  Iteration " || i || " - special case"
            END
            ELSE DO
                SAY "  Iteration " || i || " - normal processing"
            END
        END
        SAY "  Total iterations: " || counter
    </script>

</head>
<body>
    <h1>RexxJS Error Handling Demo</h1>
    <div class="intro">
        <p><strong>Auto-executing REXX script</strong> demonstrating error detection and handling patterns.</p>
        <p>Shows how to work with return codes, validate conditions, and handle errors gracefully.</p>
    </div>

    <h2>REXX Output:</h2>
    <div class="output-section">

        <script>
            // Auto-execute using shared demo executor - wait for dependencies to load
            async function runDemo() {
                // Wait for all required global objects to be available
                let attempts = 0;
                while ((typeof executeRexxDemo === 'undefined' || typeof RexxInterpreterBuilder === 'undefined') && attempts < 50) {
                    await new Promise(resolve => setTimeout(resolve, 100));
                    attempts++;
                }

                if (typeof executeRexxDemo === 'undefined') {
                    console.error('executeRexxDemo not found after 5 seconds');
                    return;
                }

                try {
                    await executeRexxDemo('error-handling-script', {
                        traceMode: 'NORMAL',
                        traceToOutput: true
                    });
                } catch (error) {
                    console.error('Failed to execute demo:', error);
                }
            }

            // Run when DOM is ready
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', runDemo);
            } else {
                runDemo();
            }
        </script>
    </div>

    <h2>Error Handling Mechanisms</h2>
    <ul>
        <li><strong>RC variable</strong> - Automatically set by the interpreter after operations</li>
        <li><strong>Conditional checks</strong> - Use IF statements to validate conditions before operations</li>
        <li><strong>SYMBOL() function</strong> - Check if a variable is defined</li>
        <li><strong>Return values</strong> - Functions return values that can be checked for success</li>
    </ul>

    <h2>The RC Variable</h2>
    <ul>
        <li><strong>RC = 0</strong> - Operation succeeded (default)</li>
        <li><strong>RC <> 0</strong> - Operation failed with specific error code</li>
        <li><strong>Check immediately</strong> - RC should be checked right after operations that might fail</li>
        <li><strong>Preserved across statements</strong> - RC retains its value until the next operation</li>
    </ul>

    <h2>Common Error Scenarios</h2>
    <ul>
        <li><strong>Division by zero</strong> - Check denominator before division</li>
        <li><strong>Invalid string operations</strong> - Check SUBSTR bounds</li>
        <li><strong>Type mismatches</strong> - Validate data types before operations</li>
        <li><strong>Missing required values</strong> - Check for null/empty strings</li>
    </ul>

    <h2>Error Prevention Patterns</h2>
    <ul>
        <li><strong>Precondition checks</strong> - Validate inputs before processing</li>
        <li><strong>Guard clauses</strong> - Use early IF checks to prevent problematic code paths</li>
        <li><strong>Graceful degradation</strong> - Provide default values or alternative paths</li>
        <li><strong>Logging and reporting</strong> - Output error conditions for debugging</li>
    </ul>

    <h2>SYMBOL() Function Values</h2>
    <ul>
        <li><strong>'LIT'</strong> - Variable is a literal (not defined as a variable)</li>
        <li><strong>'VAR'</strong> - Variable is defined</li>
        <li><strong>'BAD'</strong> - Invalid variable name</li>
    </ul>


</body>
</html>
